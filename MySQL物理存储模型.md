# MySQL物理存储模型

## 数据页

1. ### 数据页是怎么存储的？

   <img src="D:\content\markdoc\imgs\数据页存储结构.png" style="zoom:67%;" />

   1. 数据页都是放在磁盘文件中
   2. 数据页的两两相邻间采用双向链表连接
   3. 数据页就是一段数据，可能是二进制，或者是别的特殊格式，包含两个指针，一个指向上一个物理页，一个指向下一个物理页
   4. 数据行是根据主键大小由小到大进行排列的
   5. 每个数据页都有一个页目录，里面根据数据行主键存放了一个目录，同时数据行是被分散到不同槽位里去的
   
2. 仅有一个数据页如何寻找到数据？

   1. 根据主键进行查找的时候

      会先到数据页目录里根据主键进行二分查找，然后定位到具体哪个槽位，相应的读取那行数据即可

   2. 非主键查找的时候

      只能根据链表去遍历数据页的每一行数据

3. 多个数据页的情况下，如何进行查找？

   1. 根据主键进行查找的时候，根据二分查找法进行查找
   2. 不根据主键的时候，都是如上所示，根据链表进行遍历。从第一个数据页开始，从磁盘中读取到Buffer pool缓存中，如果没有则继续加载下一页。

4. 页分裂过程？

   <img src="D:\content\markdoc\imgs\页分裂过程.png" style="zoom:50%;" />

   1. 页的结构
      - 页的最开始的一行是起始行，数据类型为2，即页中最小的一行，有指针指向下一行
      - 普通行的数据类型为0，每一行都有 数据类型、id、指针、数据值这四个东西，通过指针不断的指向下一行
      - 末尾行的类型为3
   2. 页分裂过程
      1. 索引运行基础： 后一个数据也的id值都大于前一个数据页的主键值
      2. 当插入一条数据时，如上图所示，新建的一个数据页的id值是小于上一页的最大id值的，所以此时要进行页分裂
      3. 即在插入新的数据页如果无法保证顺序，则进行页分裂。
      4. 将上一个数据页id的大值，挪到后一个数据页中，将较小的id值挪到前一页中

5. 基于主键索引的查询设计

   ![](D:\content\markdoc\imgs\索引页建立过程.png)

   1. 每个数据页都有页目录，里面记录了主键和行的信息
   2. 可根据二分查找法来寻找主键的位置，定位到具体的数据页，然后再在数据页中二分查找具体行信息
   3. 索引页也是放在数据页里的
   4. 当数据页过多的时候，会抽象一层数据页，保留了最小页的最小索引值和最大页的最小索引值
   5. 如果索引页的下层索引由于页分页依然太多了怎么办？向上再抽象出一层索引页
   6. 在上述的索引页抽离过程中，即形成了一颗B+树