# 主从架构

1. ### 什么是主从复制架构？

   <img src="D:\content\markdoc\imgs\主从复制架构.png" style="zoom:67%;" />

   1. 让主节点可复制数据到从节点，保证主从数据的基本一致性
   2. 主节点宕机还可以从从节点执行SQL，保证高可用性
   3. 如长查询SQL，可专用一个库进行查询

2. ### 读写分离架构

   1. 主节点写入数据，但从从节点进行数据查询
   2. 一台专用来写入数据，其他的从节点进行数据查询

3. ### 主从复制工作原理

   1. MySQL在执行增删改的时候会记录binlog日志
   2. 从库有一个IO线程，会负责跟主库建立一个TCP连接，请求主库传输binlog日志给自己
   3. 主库上有一个dump线程，负责通过这个TCP连接把binlog日志输入给从库IO线程
   4. 从库会将binlog日志写入到自己本地的relay日志文件中去
   5. 从库另外有一线程，会读取relay日志里的内容。进行日志重做，即把在主库上的增删改日志都重做一遍

4. 