# 数据库设计

## 概述

<img src="..\imgs\simple kv 存储模块.png" style="zoom:67%;" />

1. ### 两种访问模式

   1. 提供函数库调用的方式供外部客户端使用。如提供libsimplekv.so，以动态链接库的形式链接到我们程序中，提供存储
   2. 通过网络框架的socket通信对外提供操作

2. ### 网络框架提供键值存储服务存在的问题

   1. 网络处理、请求解析、数据存储是单线程的还是多线程的？ 即网络IO应该如何进行设计
   2. 单线程如何避免阻塞
   3. 多线程的资源共享如何实现？怎么避免线程竞争？

3. ### 如何定位键值对对应的内存位置？

   1. 索引： 让键值数据库根据key查找对应的value的位置

   2. 常见的索引： hash表索引、B+树索引、字典树等

   3. 常见库及其对应的索引类型：

      Redis、memcache使用的为内存存储，由于内存有高性能的随机访问特性，而且能有hash表做O（1）的时间复杂度 ，所以一般为hash表做索引

4. ### 不同操作之间的具体逻辑差异

   1. GET/SCAN： 通过hash表根据key位置返回value对应的值即可
   2. PUT : 需要对内存分配空间
   3. DELETE: 删除并释放内存空间，由分配器完成

5. ### 存储模块

   1. 采用常见内存分配器glibc框架的mailoc和free
   2. 并不用开发人员特别考虑内存空间管理问题
   3. glibc处理随机大小内存块表现并不好，一旦key规模过大，即可造成碎片化问题
   4. 可以将key、value直接写入磁盘，但是会影响存储性能
   5. 周期性地将数据进行持久化

## Redis设计

1. ### Redis架构设计

   <img src="..\imgs\Redis模块.png" style="zoom: 67%;" />

   1. 通过网络框架访问，不是直接动态库
   2. 丰富的value模型
   3. 持久化模块。AOF和RDB
   4. 支持高可靠集群和高可扩展集群

